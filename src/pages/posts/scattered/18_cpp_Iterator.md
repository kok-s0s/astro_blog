---
title: 'C++ 迭代器'
---

迭代器是用于遍历容器（如数组、链表、集合等）元素的对象。理解迭代器的原理及其失效问题对于编写高效且正确的代码非常重要。以下是关于迭代器原理和迭代器失效问题的详细介绍：

### 迭代器原理

1. **基本概念**：
   迭代器是一个对象，它通过重载 `*`（解引用）和 `++`（递增）运算符来遍历容器中的元素。可以将迭代器视为一个指针，它“指向”容器中的当前元素。

2. **类型**：
   - **输入迭代器**：只支持单次读取操作。
   - **输出迭代器**：只支持单次写入操作。
   - **前向迭代器**：支持多次读取和写入操作，但只能向前移动。
   - **双向迭代器**：支持向前和向后移动。
   - **随机访问迭代器**：支持在常数时间内随机访问容器中的任意位置。

3. **使用**：
   迭代器通常与循环结构（如 `for` 循环）一起使用，通过不断递增迭代器来访问容器中的所有元素。

```cpp
std::vector<int> vec = {1, 2, 3, 4, 5};
for (auto it = vec.begin(); it != vec.end(); ++it) {
    std::cout << *it << " ";
}
```

### 迭代器失效问题

迭代器失效指的是在容器中对元素进行修改（如插入、删除）后，原有的迭代器可能变得无效。这种情况会导致未定义行为。迭代器失效问题主要取决于容器的类型及其操作：

1. **向量（`std::vector`）**：
   - **插入**：在中间插入元素时，可能导致原有迭代器失效，因为容器可能会重新分配内存。
   - **删除**：删除元素时，迭代器可能会失效，尤其是删除的元素位于迭代器所指向的位置之前。

   **解决方法**：
   使用 `std::vector` 时，如果需要频繁插入或删除操作，考虑使用其他容器或在操作前保存有效的迭代器。

2. **链表（`std::list`）**：
   - **插入**：在链表中插入元素不会导致迭代器失效，因为链表的结构不涉及重新分配内存。
   - **删除**：删除操作可能会使指向删除元素的迭代器失效，但不会影响其他迭代器。

3. **集合（`std::set` 和 `std::map`）**：
   - **插入**：插入操作不会使已存在的迭代器失效，除了插入操作可能使迭代器指向的元素的顺序发生变化。
   - **删除**：删除操作会使指向被删除元素的迭代器失效，但其他迭代器通常不会受到影响。

4. **解决方案**：
   - **重新获取迭代器**：在进行容器操作后，重新获取迭代器。
   - **避免在迭代时修改容器**：尽量避免在遍历容器时修改它，尤其是插入和删除操作。
   - **使用合适的容器**：根据需要选择适当的容器，例如，使用 `std::list` 来处理频繁插入和删除操作。

通过理解迭代器原理和失效问题，可以在编写代码时采取相应的策略来避免潜在的错误，确保程序的稳定性和性能。
